!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.TutorsAsyncStorage=e()}}(function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;i.length>s;s++)r(i[s]);return r}({1:[function(e,t){"use strict";var n=e("./jschannel"),i=e("embed-js/deferred"),r=function(e,t){for(var n in e)!e.hasOwnProperty(n)||n in t||(t[n]=e[n])},o=function(e,t){e=e||{};var o=this,s=null,a=!1,u=[],l=e.onReady,c={origin:"*",scope:"testScope"};this._call=function(e){var t=e.deferred||i();return a?(e.success=function(){t.resolve.apply(null,arguments)},e.error=function(e,n){throw t.reject.apply(null,arguments),e+": "+n},s.call(e)):(e.deferred=t,u.push(e)),t},r(c,e),e.onReady=function(){a=!0,"function"==typeof l&&l();for(var e=0;u.length>e;e++)o._call(u[e])},this.build=function(t){e.window=t.contentWindow,s=n(window).build(e)},t&&this.build(t)},s=function(e,t,n){return this._call({method:e,params:{regex:t,modifiers:n}})};o.prototype={length:function(){return this._call({method:"length"})},key:function(e){return this._call({method:"key",params:e})},keysLike:function(e,t){return s.call(this,"keysLike",e,t)},getItem:function(e){return this._call({method:"getItem",params:e})},getItems:function(e){return this._call({method:"getItems",params:e})},getItemsWithKeysLike:function(e,t){return s.call(this,"getItemsWithKeysLike",e,t)},setItem:function(e,t,n){return this._call({method:"setItem",params:{key:e,data:t,expires:n}})},setItems:function(e){return this._call({method:"setItems",params:e})},removeItem:function(e){return this._call({method:"removeItem",params:e})},removeItems:function(e){return this._call({method:"removeItems",params:e})},removeItemsWithKeysLike:function(e,t){return s.call(this,"removeItemsWithKeysLike",e,t)},clear:function(){return this._call({method:"clear"})}};var a=function(e,t){t=t||{};var i={window:e.parent,origin:"*",scope:"testScope"};r(i,t);var o=n(e).build(t),s=t.storage||e.localStorage,a=function(e){var t=RegExp(e.regex,e.modifiers||""),n=[];for(var i in s)t.test(i)&&n.push(i);return n},u=function(e,t,n){return t={data:t},parseInt(n)&&(t.expires=(new Date).getTime()+n),s.setItem(e,JSON.stringify(t))},l=function(e){var t=s.getItem(e);if(t){try{t=JSON.parse(t)}catch(n){return t}"object"==typeof t&&"data"in t&&(t.expires&&t.expires<(new Date).getTime()&&(s.removeItem(e),t.data=null),t=t.data)}return t};for(var c in s)l(c);o.bind("length",function(){return s.length}),o.bind("key",function(e,t){return s.key(t)}),o.bind("keysLike",function(e,t){return a(t)}),o.bind("getItem",function(e,t){return l(t)}),o.bind("getItems",function(e,t){for(var n={},i=0;t.length>i;i++)n[t[i]]=l(t[i]);return n}),o.bind("getItemsWithKeysLike",function(e,t){for(var n=a(t),i={},r=0;n.length>r;r++)i[n[r]]=l(n[r]);return i}),o.bind("setItem",function(e,t){return u(t.key,t.data,t.expires)}),o.bind("setItems",function(e,t){for(var n in t)t.hasOwnProperty(n)&&u(n,t[n])}),o.bind("removeItem",function(e,t){return s.removeItem(t)}),o.bind("removeItems",function(e,t){for(var n=0;t.length>n;n++)s.removeItem(t[n])}),o.bind("removeItemsWithKeysLike",function(e,t){for(var n=a(t),i=0;n.length>i;i++)s.removeItem(n[i])}),o.bind("clear",function(){return s.clear()})};t.exports={parent:function(e,t){return new o(e,t)},child:a}},{"./jschannel":3,"embed-js/deferred":2}],2:[function(e,t){"use strict";var n=function(){var e={resolved:!1,rejected:!1};return e.promise=new Promise(function(t,n){e.resolve=function(){e.resolved=!0,t.apply(e,arguments)},e.reject=function(){e.rejected=!0,n.apply(e,arguments)}}),e.then=e.promise.then.bind(e.promise),e["catch"]=e.promise["catch"].bind(e.promise),e};n.makeDeferred=function(e){var t=n();e.resolve=t.resolve.bind(t),e.reject=t.reject.bind(t),e.then=t.promise.then.bind(t.promise),e["catch"]=t.promise["catch"].bind(t.promise)},t.exports=n},{}],3:[function(e,t){"use strict";t.exports=function(e){function t(e,t,n,i){function r(t){for(var n=0;t.length>n;n++)if(t[n].win===e)return!0;return!1}var s=!1;if("*"===t){for(var a in o)if(o.hasOwnProperty(a)&&"*"!==a&&"object"==typeof o[a][n]&&(s=r(o[a][n])))break}else o["*"]&&o["*"][n]&&(s=r(o["*"][n])),!s&&o[t]&&o[t][n]&&(s=r(o[t][n]));if(s)throw"A channel is already bound to the same window which overlaps with origin '"+t+"' and has scope '"+n+"'";"object"!=typeof o[t]&&(o[t]={}),"object"!=typeof o[t][n]&&(o[t][n]=[]),o[t][n].push({win:e,handler:i})}function n(e,t,n){for(var i=o[t][n],r=0;i.length>r;r++)i[r].win===e&&i.splice(r,1);0===o[t][n].length&&delete o[t][n]}function i(e){return Array.isArray?Array.isArray(e):-1!=(""+e.constructor).indexOf("Array")}var r=Math.floor(1000001*Math.random()),o={},s={},a=function(e){try{var t=JSON.parse(e.data);if("object"!=typeof t||null===t)throw"malformed"}catch(e){return}var n,i,r,a=e.source,u=e.origin;if("string"==typeof t.method){var l=t.method.split("::");2==l.length?(n=l[0],r=l[1]):r=t.method}if(t.id!==void 0&&(i=t.id),"string"==typeof r){var c=!1;if(o[u]&&o[u][n])for(var h=0;o[u][n].length>h;h++)if(o[u][n][h].win===a){o[u][n][h].handler(u,r,t),c=!0;break}if(!c&&o["*"]&&o["*"][n])for(var h=0;o["*"][n].length>h;h++)if(o["*"][n][h].win===a){o["*"][n][h].handler(u,r,t);break}}else i!==void 0&&s[i]&&s[i](u,r,t)};return e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent&&e.attachEvent("onmessage",a),{build:function(o){var a=function(t){if(o.debugOutput&&e.console&&e.console.log){try{"string"!=typeof t&&(t=JSON.stringify(t))}catch(n){}console.log("["+c+"] "+t)}};if(!e.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!e.JSON||!e.JSON.stringify||!e.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof o)throw"Channel build invoked without a proper object argument";if(!o.window||!o.window.postMessage)throw"Channel.build() called without a valid window argument";if(e===o.window)throw"target window is same as present window -- not allowed";var u=!1;if("string"==typeof o.origin){var l;"*"===o.origin?u=!0:null!==(l=o.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(o.origin=l[0].toLowerCase(),u=!0)}if(!u)throw"Channel.build() called with an invalid origin";if(o.scope!==void 0){if("string"!=typeof o.scope)throw"scope, when specified, must be a string";if(o.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}var c=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),h={},d={},p={},f=!1,m=[],g=function(e,t,n){var i=!1,r=!1;return{origin:t,invoke:function(t,i){if(!p[e])throw"attempting to invoke a callback of a nonexistent transaction: "+e;for(var r=!1,o=0;n.length>o;o++)if(t===n[o]){r=!0;break}if(!r)throw"request supports no such callback '"+t+"'";y({id:e,callback:t,params:i})},error:function(t,n){if(r=!0,!p[e])throw"error called for nonexistent message: "+e;delete p[e],y({id:e,error:t,message:n})},complete:function(t){if(r=!0,!p[e])throw"complete called for nonexistent message: "+e;delete p[e],y({id:e,result:t})},delayReturn:function(e){return"boolean"==typeof e&&(i=e===!0),i},completed:function(){return r}}},v=function(t,n,i){return e.setTimeout(function(){if(d[t]){var e="timeout ("+n+"ms) exceeded on method '"+i+"'";d[t].error("timeout_error",e),delete d[t],delete s[t]}},n)},_=function(e,t,n){if("function"==typeof o.gotMessageObserver)try{o.gotMessageObserver(e,n)}catch(r){a("gotMessageObserver() raised an exception: "+(""+r))}if(n.id&&t){if(h[t]){var u=g(n.id,e,n.callbacks?n.callbacks:[]);p[n.id]={};try{if(n.callbacks&&i(n.callbacks)&&n.callbacks.length>0)for(var l=0;n.callbacks.length>l;l++){for(var c=n.callbacks[l],f=n.params,m=c.split("/"),v=0;m.length-1>v;v++){var _=m[v];"object"!=typeof f[_]&&(f[_]={}),f=f[_]}f[m[m.length-1]]=function(){var e=c;return function(t){return u.invoke(e,t)}}()}var b=h[t](u,n.params);u.delayReturn()||u.completed()||u.complete(b)}catch(r){var y="runtime_error",w=null;if("string"==typeof r?w=r:"object"==typeof r&&(r&&i(r)&&2==r.length?(y=r[0],w=r[1]):"string"==typeof r.error&&(y=r.error,r.message?"string"==typeof r.message?w=r.message:r=r.message:w="")),null===w)try{w=JSON.stringify(r),w===void 0&&(w=""+r)}catch(E){w=""+r}u.error(y,w)}}}else n.id&&n.callback?d[n.id]&&d[n.id].callbacks&&d[n.id].callbacks[n.callback]?d[n.id].callbacks[n.callback](n.params):a("ignoring invalid callback, id:"+n.id+" ("+n.callback+")"):n.id?d[n.id]?(n.error?d[n.id].error(n.error,n.message):void 0!==n.result?d[n.id].success(n.result):d[n.id].success(),delete d[n.id],delete s[n.id]):a("ignoring invalid response: "+n.id):t&&h[t]&&h[t]({origin:e},n.params)};t(o.window,o.origin,"string"==typeof o.scope?o.scope:"",_);var b=function(e){return"string"==typeof o.scope&&o.scope.length&&(e=[o.scope,e].join("::")),e},y=function(e,t){if(!e)throw"postMessage called with null message";var n=f?"post  ":"queue ";if(a(n+" message: "+JSON.stringify(e)),t||f){if("function"==typeof o.postMessageObserver)try{o.postMessageObserver(o.origin,e)}catch(i){a("postMessageObserver() raised an exception: "+(""+i))}o.window.postMessage(JSON.stringify(e),o.origin)}else m.push(e)},w=function(e,t){if(a("ready msg received"),f)throw"received ready message while in ready state.  help!";for(c+="ping"===t?"-R":"-L",E.unbind("__ready"),f=!0,a("ready msg accepted."),"ping"===t&&E.notify({method:"__ready",params:"pong"});m.length;)y(m.pop());"function"==typeof o.onReady&&o.onReady(E)},E={unbind:function(e){if(h[e]){if(!delete h[e])throw"can't delete method: "+e;return!0}return!1},bind:function(e,t){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(h[e])throw"method '"+e+"' is already bound!";return h[e]=t,this},call:function(e){if(!e)throw"missing arguments to call function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to call must be string";if(!e.success||"function"!=typeof e.success)throw"'success' callback missing from call";var t={},n=[],i=function o(e,i){if("object"==typeof i)for(var r in i)if(i.hasOwnProperty(r)){var s=e+(e.length?"/":"")+r;"function"==typeof i[r]?(t[s]=i[r],n.push(s),delete i[r]):"object"==typeof i[r]&&o(s,i[r])}};i("",e.params);var a={id:r,method:b(e.method),params:e.params};n.length&&(a.callbacks=n),e.timeout&&v(r,e.timeout,b(e.method)),d[r]={callbacks:t,error:e.error,success:e.success},s[r]=_,r++,y(a)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";y({method:b(e.method),params:e.params})},destroy:function(){n(o.window,o.origin,"string"==typeof o.scope?o.scope:""),e.removeEventListener?e.removeEventListener("message",_,!1):e.detachEvent&&e.detachEvent("onmessage",_),f=!1,h={},p={},d={},o.origin=null,m=[],a("channel destroyed"),c=""}};return E.bind("__ready",w),setTimeout(function(){y({method:b("__ready"),params:"ping"},!0)},0),E}}}},{}]},{},[1])(1)});
//# sourceMappingURL=asyncStorage.js.map