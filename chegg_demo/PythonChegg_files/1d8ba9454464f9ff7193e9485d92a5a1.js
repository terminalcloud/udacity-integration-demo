Eggshell.define("C.common.twilio",{inputs:["render twilio inline","render twilio field","set placeholder text","send text","listen for enter submit","set submit listener","set send text data","set input size","set auto focus"],outputs:["send text success","send text failure","input submitted"]},function(){var View=Backbone.View.extend({initialize:function(payload){this.placeholderText="888-888-8888";this.sendTextData=null;this.inputSize="sm";this.autofocus_enabled=true;Eggshell.find(this).on("render twilio inline",this.renderTwilioInline,this).on("render twilio field",this.renderTwilioField,this).on("set placeholder text",this.setPlaceholderText,this).on("set send text data",this.setSendTextData,this).on("set input size",this.setInputSize,this).on("listen for enter submit",this.setupEnterListener,this).on("set submit listener",this.setupSubmitListener,this).on("send text",this.sendText,this).on("set auto focus",this.setAutoFocus,this)},renderTwilioInline:function(e,payload){this.$el.html('<div class="mobile-location-checkout">'+'<div class="mobile-number-label">Mobile number (optional)</div>'+'<div class="mobile-number-container"><input maxlength="12" name="mobile_num" type="text" placeholder="'+this.placeholderText+'" value="" /></div>'+'<div class="mobile-number-desc">'+'<div class="mobile-number-header">Get the Chegg mobile app texted to you</div>'+'<div class="mobile-number-details">Message and data rates may apply. Message may be sent using an automatic telephone dialing system. Consent not required to purchase goods or services. For help, reply HELP to any text. Read <a href="/mobiledisclosures" target="_blank">Chegg\'s Mobile Disclosures</a>.</div>'+"</div>"+"</div>");$(payload.container).append(this.$el)},twilioInlineTmpl:_.template('<div class="mobile-location-postcheckout">'+'<div class="mobile-number-container"><input class="form-input-<%- inputSize %>" maxlength="12" name="mobile_num" type="text" placeholder="<%- placeholderText %>" value="" <%- autofocus %>/></div>'+"</div>"),renderTwilioField:function(e,payload){var autofocus=this.autofocus_enabled?"autofocus":"";this.$el.html(this.twilioInlineTmpl({inputSize:this.inputSize,placeholderText:this.placeholderText,autofocus:autofocus}));$(payload.container).append(this.$el)},setPlaceholderText:function(e,payload){if(!payload||typeof payload!=="string"){throw"Invalid placeholder text!"}this.placeholderText=payload},onMobileNumberKeyUp:function(e){var $target=$(e.currentTarget),val=$target.val();val=val.replace(/\D/g,"");val=val.replace(/(\d{3})(\d{1,3})(\d*)/,"$1-$2-$3");val=val.replace(/\-$/,"");$target.val(val)},setupEnterListener:function(e,payload){$("input[name=mobile_num]").on("keydown",$.proxy(function(e){if(e.keyCode===13){this.sendText()}},this))},setupSubmitListener:function(e,className){if(!className||typeof className!=="string"){throw"Invalid submit class name for twilio"}else{$("."+className).on("click",$.proxy(function(e){e.preventDefault();this.sendText()},this))}},setSendTextData:function(e,data){this.sendTextData=data},setInputSize:function(e,data){if(data==="sm"||data==="lg"){this.inputSize=data}},sendText:function(e){this.Eggshell.trigger("input submitted");var phoneNum=$("input[name=mobile_num]").val();var sendData=this.sendTextData?$.extend(this.sendTextData,{token:C.global.csrfToken,phoneNum:phoneNum}):null;if(sendData.phoneNum&&/\d{3}-\d{3}-\d{4}/.test(sendData.phoneNum)){$.ajax({url:"/_ajax/hwh/twilio/",type:"POST",data:sendData,context:this,success:function(data){this.Eggshell.trigger("send text success")},error:function(data){this.Eggshell.trigger("send text failure");this.showSendTextFailureMsg("Error sending message. Please try again.")}})}else{this.Eggshell.trigger("send text failure");this.showSendTextFailureMsg("Please enter a valid phone number.")}},setAutoFocus:function(e,args){this.autofocus_enabled=args.enabled},showSendTextFailureMsg:function(errorMessage){$(".twilio-error-msg").remove();this.$el.append('<div class="twilio-error-msg">'+errorMessage+"</div>")},events:{"keyup [name=mobile_num]":"onMobileNumberKeyUp"}});return View}());Eggshell.define("C.cs.apppromomodal",{inputs:["render"],outputs:[],strict:false},function(){var View=Backbone.View.extend({initialize:function(payload){this.opts=$.extend(payload,{});this.Eggshell.on("render",this.render,this)},render:function(){this.dialog=Eggshell.create("C.common.dialog").trigger("hide control").trigger("hide close button").trigger("disable screen blocker click").trigger("set content html",this.modalTemplate());var dialogSelector=this.dialog.getId().replace(".","-");$("#"+dialogSelector).addClass("apppromomodal-dialog");this.renderTwilio();$(".apppromomodal-skip-link").on("click",$.proxy(function(e){this.storeModalViewKvp()},this))},renderTwilio:function(){this.twilioComponent=Eggshell.create("C.common.twilio").trigger("render twilio field",{container:".apppromomodal-twilio-input"}).trigger("set send text data",{text:this.opts.textMsg}).trigger("listen for enter submit").trigger("set submit listener","apppromomodal-send-btn");Eggshell.find(this.twilioComponent).on("input submitted",function(){$(".apppromomodal-send-btn").attr("disabled","disabled")});Eggshell.find(this.twilioComponent).on("send text failure",$.proxy(function(){$(".apppromomodal-send-btn").attr("disabled",false)},this));Eggshell.find(this.twilioComponent).on("send text success",$.proxy(function(){this.storeModalViewKvp()},this))},modalTemplate:_.template('<div class="apppromomodal">'+'<div class="apppromomodal-app-stars"><span class="appromomodal-star-icons"></span>4,000+ five star reviews. | Available on iOS and Android</div>'+'<div class="apppromomodal-header">Take Chegg Study with you on-the-go</div>'+'<div class="apppromomodal-content">'+'<div class="apppromomodal-image"></div>'+'<div class="apppromomodal-valueprop">'+'<div class="apppromomodal-subheader">We\'ll send you a one time download link</div>'+'<div class="apppromomodal-proofpoints">'+'<ul class="chg-list">'+"<li><span>Take your textbook solutions on-the-go</span></li>"+"<li><span>Ask questions anywhere with your phone camera</span></li>"+"<li><span>Get notified right away when your questions are answered</span></li>"+"</div>"+"</div>"+'<div class="apppromomodal-twilio-input"></div>'+'<div class="apppromomodal-actions">'+'<button class="apppromomodal-send-btn btn-primary-sm">Text me</button>'+'<div class="apppromomodal-skip-link"><a href="#">No thanks</a></div>'+"</div>"+'<div class="apppromomodal-disclaimer">Your number won\'t be shared or stored. <a href="/mobiledisclosures">Chegg\'s Mobile Disclosures.</a><div>'+"</div>"+"</div>"),storeModalViewKvp:function(){$.ajax({url:"/_ajax/common/userkvp/set",type:"GET",data:{token:C.global.csrfToken,key:"showAppPromoModal",value:false},context:this,success:function(response){Eggshell.find(this.dialog).trigger("hide").trigger("destroy")},error:function(response){Eggshell.find(this.dialog).trigger("hide").trigger("destroy");console.log("Error storing user kvp value "+JSON.stringify(response))}})}});return View}());Eggshell.define("C.common.tutors",{inputs:["set opportunity modal data","show tutors","set_quick_chat_data"],outputs:["error","ready"],singleton:true},function(){var tutorModel=Backbone.Model.extend({getTutors:function(payload){var limit="undefined"!==typeof payload.count?payload.count:3,noSubjectCheck="undefined"!==typeof payload.noSubjectCheck?payload.noSubjectCheck:0;$.ajax({context:this,type:"GET",dataType:"JSON",url:"/_ajax/tutors",data:{token:C.global.csrfToken,subjectId:payload.subjectId,subjectName:payload.subjectName,campaign:payload.campaign,limit:limit,noSubjectCheck:noSubjectCheck},success:function(response){if($.isEmptyObject(response)){this.trigger("errored")}else{this.set("response",response);this.trigger("loaded")}},error:function(){this.trigger("errored")}})},getSessionVariable:function(key){$.ajax({url:"/_ajax/common/session/get",type:"get",dataType:"json",data:{key:key,token:C.global.csrfToken},context:this,success:function(data){this.set(key,data)},error:function(){this.set(key,{value:"0"})}})},setSessionVariable:function(key,value){$.ajax({url:"/_ajax/common/session/set",type:"get",dataType:"json",data:{key:key,value:value,token:C.global.csrfToken},context:this})},getAccessCode:function(data,callback){$.ajax({url:"/_ajax/hwh/grantaccess",type:"get",dataType:"json",data:{assetId:data.assetId,assetType:data.assetType,offer:data.offer,userAgent:data.userAgent,token:C.global.csrfToken},context:this,complete:function(response){var responseData=$.parseJSON(response.responseText);if(responseData&&responseData.accessCode&&typeof responseData.accessCode==="string"){this.set("accessCode",responseData.accessCode)}else{this.set("accessCode",null)}this.trigger(callback)}})}});var tutorView=Backbone.View.extend({tutorTemplate:_.template('<div class="tutor-container <%= variant %> clearfix">'+'<div class="tutor-headline"></div>'+'<div class="tutor-content"></div>'+'<div class="tutors-footer"></div>'+"</div>"),tutorLiveLessonTemplate:_.template('<div class="tutor-container <%= variant %> clearfix">'+'<div class="tutor-left-content"></div>'+'<div class="tutor-right-content">'+'<span class="header"></span>'+'<span class="sub-header"></span>'+'<button class="live-lesson-btn btn-outline-sm">Get live help now</button>'+"<div>"+"</div>"),initialize:function(){this.model=new tutorModel;this.setUpListeners()},setUpListeners:function(){this.model.on("loaded",this.render,this);this.model.on("errored",this.renderError,this);this.model.on("do_member_tbs_opportunity_flow",this.doMemberTbsOpportunityFlow,this);this.model.on("open_start_search",this.openStartSearch,this);Eggshell.find(this).on("set opportunity modal data",this.setOpportunityModalData).on("show tutors",this.showTutors).on("set_quick_chat_data",this.setupQuickChat)},setupQuickChat:function(e,payload){this.$quickChatContainerElem=payload.elem;this.quickChatExperience=payload.experience;this.quickChatOcUrl=payload.quickChatOcPath;this.doQuickChat=payload.experience=="quickchat"?true:false;if(this.doQuickChat){this.insertQuickChatComponent()}},setOpportunityModalData:function(e,payload){this.modalContext=payload.modalContext;this.modalBody=payload.modalBody},showTutors:function(event,payload){this.model.getTutors(payload);this.source=payload.type;this.product=payload.product;this.variant=payload.variant?payload.variant:"";this.subject=payload.subjectName;this.subjectId=payload.subjectId;this.tbsProblemId=payload.tbsProblemId;this.liveLessonText=payload.liveLessonText;this.url=payload.url;this.tutorSubType=payload.tutorSubType;this.userHasCsSubscription=payload.userHasCsSubscription;this.entityId=payload.entityId},render:function(){var response=this.model.get("response");var template=this.getTemplate();this.$el.empty();this.$el.html(template({variant:this.variant}));this.renderTutors(response)},getTemplate:function(){switch(this.source){case"tbs-live-lesson":return this.tutorLiveLessonTemplate;case"rightrail":case"tbs":case"cshp":default:return this.tutorTemplate}},renderTutors:function(response){var tutors=response.tutors,url=response.url,subject=response.exception||null===this.model.get("subjectId")?"Top":this.subject,headline='<span class="subject">'+subject+"</span> Chegg tutors who can help right now",footer='<a href="'+url+'" data-noajax><button class="tutors-cta btn-flat-sm">See more Chegg tutors</button></a>',i=0,element=$(".tutor-content");switch(this.source){case"rightrail":this.$(".tutor-headline").html(headline);this.$(".tutors-footer").html(footer);this.$(".tutors-cta").addClass("rightrail-cta");for(i=0;i<tutors.length;i++){this.displayQnaTutors(tutors[i],element,"qna")}if(response.exception){$(".online-indicator ").addClass("hidden")}if(this.modalContext){$(".tutors-cta").text("Find me a tutor");this.listenToOpportunityClick()}else{this.setupDefaultListeners()}break;case"tbs":this.$(".tutor-headline").html(headline);this.$(".tutors-footer").html(footer);this.$(".tutors-footer").addClass("tbs-footer");$(".tutor-container").css({padding:"20px"});if(tutors.length%2==0){tutors.splice(tutors.length-1,1)}for(i=0;i<tutors.length-1;i=i+2){this.displayleftTutor(tutors[i],element);this.displayRightTutor(tutors[i+1],element)}if(tutors.length%2!==0){this.displayleftTutor(tutors[i],element)}if(this.modalContext){$(".tutors-cta").text("Find me a tutor");this.listenToOpportunityClick()}else{this.setupDefaultListeners()}break;case"cshp":headline="Find an online tutor who can help with your toughest classes. Connect instantly or schedule a convenient time to meet.";for(i=0;i<tutors.length-1;i=i+2){this.displayleftTutor(tutors[i],element);this.displayRightTutor(tutors[i+1],element)}$(".tutor-container").addClass("cshp-container");$(".tutor-card").addClass("cshp-card");$(".tutor-headline").html(headline);$(".tutors-footer").html(footer);$(".tutors-cta").html("Find a tutor");this.setupDefaultListeners();break;case"tbs-live-lesson":element=$(".tutor-left-content");var subheaderPrefix="";if(this.tutorSubType&&this.tutorSubType=="TRIAL"){subheaderPrefix='You have a <span class="tutor-time">free trial</span> of online tutoring. '}$(".tutor-right-content .header").html(subject+" tutors are online and ready to help now!");$(".tutor-right-content .sub-header").html(subheaderPrefix+"Tell us what you need help with and we’ll connect you with a qualified tutor in our online lesson space.");$(".tutor-container").addClass("tutor-livelesson-container");for(i=0;i<tutors.length;i++){this.displayTransparentTutor(tutors[i],element)}this.setupDefaultListeners();C.logger.doSessionLog({liveLessonTutorsComp_shown:1});break}Eggshell.find(this).trigger("ready")},listenToOpportunityClick:function(){$(".tutor-row, .tutors-cta").on("click",$.proxy(function(e){e.preventDefault();e.stopPropagation();if($(e.currentTarget).hasClass("tutor-row")){C.logger.doSessionLog({tutor_clicked:1});this.tutorsRedirectUrl=$(e.currentTarget).find("a").attr("href")}else{C.logger.doSessionLog({tutors_button_clicked:1});this.tutorsRedirectUrl=$(e.currentTarget).parent().attr("href")}if(this.product=="TBS"){this.doTbsOpportunityClickBehavior(e)}else{this.doGenericOpportunityFlow(e)}},this))},doTbsOpportunityClickBehavior:function(e){e.preventDefault();e.stopPropagation();var grantAccessData=this.getGrantAccessData();this.model.getAccessCode(grantAccessData,"do_member_tbs_opportunity_flow")},doMemberTbsOpportunityFlow:function(){var accessCode=this.model.get("accessCode");this.modalBody+="?access_code="+accessCode;this.setOpportunityModalCookie();C.utility.navigate(this.tutorsRedirectUrl)},doGenericOpportunityFlow:function(e){if(this.doQuickChat){var id=$(e.currentTarget).find("a").data("id");this.openQuickChat(id)}else{this.setOpportunityModalCookie();C.utility.navigate(this.tutorsRedirectUrl)}},setOpportunityModalCookie:function(){var response=this.model.get("response"),tutorSubjectId=response&&response.instaEduSubjectId?response.instaEduSubjectId:this.subjectId;var date=new Date,currentTime=date.getTime();date.setTime(currentTime+10*60*1e3);var expiry=date.toGMTString();var delimiter=".chegg",host=window.location.host.split(delimiter),domain=delimiter+host[1];var context=this.quickChatExperience=="control"?this.modalContext+"_CONTROL":this.modalContext;var data='{"formData":{'+'"body":"'+this.modalBody+'",'+'"modalContext":"'+context+'",'+'"subject":"'+this.subject+'",'+'"subjectID":"'+tutorSubjectId+'",'+'"priority":1,'+'"isBlast":true,'+'"timestamp": '+currentTime+"}}";document.cookie="messageData="+data+";domain="+domain+";path=/; expires="+expiry},setupDefaultListeners:function(){$tutor=$(".tutor-content .C-common-tutors-tutor");$tutorsCta=$(".tutors-cta");$liveLessonHelpBtn=$(".tutor-livelesson-container .live-lesson-btn");$tutor.on("click",$.proxy(function(e){var target=$(e.currentTarget);e.preventDefault();C.logger.doSessionLog({tutor_clicked:1});location.href=target.find("a").attr("href")},this));$tutorsCta.on("click",$.proxy(function(e){e.preventDefault();C.logger.doSessionLog({tutors_button_clicked:1});location.href=$tutorsCta.parent().attr("href")},this));$liveLessonHelpBtn.on("click",$.proxy(function(e){e.preventDefault();C.logger.doSessionLog({liveLessonTutorsComp_ctaClicked:1});var grantAccessData=this.getGrantAccessData();this.model.getAccessCode(grantAccessData,"open_start_search")},this))},getGrantAccessData:function(){return{assetId:this.tbsProblemId,assetType:"TBS",offer:"TBS_SOLUTION_2H_ACCESS",userAgent:"WEB"}},openStartSearch:function(){var response=this.model.get("response"),accessCode=this.model.get("accessCode"),subjectId=response&&response.instaEduSubjectId?response.instaEduSubjectId:null,liveLessonText=this.liveLessonText?this.liveLessonText:"",tbsAccessUrl=this.url?this.url:"";if(typeof accessCode==="string"&&tbsAccessUrl){tbsAccessUrl+="?access_code="+accessCode}liveLessonText=liveLessonText.replace("https://www.chegg.com/study/tbs",tbsAccessUrl);postForm("/tutors/start-search/?filter-subjects="+subjectId,{"student-question":liveLessonText},"post","_blank")},insertQuickChatComponent:function(){this.$quickChatContainerElem.append('<oc-component href="'+this.quickChatOcUrl+'"></oc-component>');oc.renderUnloadedComponents()},openQuickChat:function(id){var response=this.model.get("response"),tutorSubjectId=response&&response.instaEduSubjectId?response.instaEduSubjectId:this.subjectId,assetType=this.product=="QNA"?"QnA":this.product;var options={subjectId:tutorSubjectId,tutorId:id?id:null,asset:{type:assetType,id:this.entityId}};window.startQuickChat(options)},displayQnaTutors:function(tutor,element,type){var $qnaTutor=$('<div class="tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:$qnaTutor}).trigger("get "+type+" tutor",tutor);element.append($qnaTutor)},displayleftTutor:function(tutor,element){var $tbsTutor=$('<div class="tutor-card left-card tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:$tbsTutor}).trigger("get tbs tutor",tutor);element.append($tbsTutor)},displayRightTutor:function(tutor,element){var $tbsTutor=$('<div class="tutor-card right-card tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:$tbsTutor}).trigger("get tbs tutor",tutor);element.append($tbsTutor)},displayTransparentTutor:function(tutor,element){var $tutorCard=$('<div class="tutor-transparent-card tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:$tutorCard}).trigger("get transparent tutor",tutor);element.append($tutorCard)},renderError:function(){Eggshell.find(this).trigger("error")}});return tutorView}());Eggshell.define("C.common.tutors.tutor",{inputs:["get qna tutor","get tbs tutor","get mystuff tutor","get transparent tutor"],outputs:[]},Backbone.View.extend({tutorTemplate:_.template('<a href="<%= uri %>" data-noajax data-id=<%= id %>>'+'<div class="online-indicator <%= hidden %>">'+'<div class="circle-icn"></div>'+'<div class="check-icn"></div>'+"</div>"+'<img class="tutor-img" src="<%= picture %>" onError="this.onerror=null;this.src=\'<%= default_picture %>\'">'+'<div class="tutor-info">'+'<div class="name"><%= name %></div>'+'<div class="school"><%= school %></div>'+"</div>"+'<div class="tutor-likes">'+'<div class="thumbs-icn">'+'<div class="reviews"><%= reviews %></div>'+"</div>"+"</div>"+"</a>"),transparentTutorTemplate:_.template('<div class="tutor-likes">'+'<div class="thumbs-icn"></div>'+'<div class="reviews"><%= reviews %></div>'+"</div>"+'<img class="tutor-img" src="<%= picture %>" onError="this.onerror=null;this.src=\'<%= default_picture %>\'">'+'<div class="tutor-info">'+'<div class="name"><%= name %></div>'+'<div class="school"><%= school %></div>'+"</div>"),initialize:function(){this.setUpListeners()},setUpListeners:function(){Eggshell.find(this).on("get qna tutor",this.renderQnaTutor,this).on("get tbs tutor",this.renderTbsTutor,this).on("get mystuff tutor",this.renderMyStuffTutor,this).on("get transparent tutor",this.renderTransparentTutor,this)},renderQnaTutor:function(e,payload){var lname=payload.last_name.charAt(0)+".",name=payload.first_name+" "+lname;this.$el.html(this.tutorTemplate({uri:payload.uri,hidden:"",picture:payload.image_thumb_small,default_picture:payload.default_images.image_thumb_small,name:name,school:payload.school,reviews:payload.positive_reviews,id:payload.id}));if(payload.available_now){this.$(".circle-icn").hide()}else{this.$(".check-icn").hide()}},renderTbsTutor:function(e,payload){var lname=payload.last_name.charAt(0)+".",name=payload.first_name+" "+lname;this.$el.html(this.tutorTemplate({uri:payload.uri,hidden:"hidden",picture:payload.image_thumb_medium,default_picture:payload.default_images.image_thumb_medium,name:name,school:payload.school,reviews:payload.positive_reviews,id:payload.id}))},renderTransparentTutor:function(e,payload){var lname=payload.last_name.charAt(0)+".",name=payload.first_name+" "+lname;this.$el.html(this.transparentTutorTemplate({picture:payload.image_thumb_medium,default_picture:payload.default_images.image_thumb_medium,name:name,school:payload.school,reviews:payload.positive_reviews}))},renderMyStuffTutor:function(e,payload){var lname=payload.last_name.charAt(0)+".",name=payload.first_name+" "+lname;this.$el.html(this.tutorTemplate({uri:payload.uri,hidden:"",picture:payload.image_thumb_small,default_picture:payload.default_images.image_thumb_small,name:name,school:payload.school,reviews:payload.positive_reviews,id:payload.id}));this.$(".tutor-info").append(this.$(".tutor-likes"));this.$(".check-icn").hide();if(!payload.available_now&&payload.chat_availability!==3){this.$(".circle-icn").hide()}}}));function postForm(path,params,method,target){method=method||"post";target=target||"_self";var form=document.createElement("form");form.setAttribute("method",method);form.setAttribute("action",path);form.setAttribute("target",target);for(var key in params){if(params.hasOwnProperty(key)){var hiddenField=document.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",params[key]);form.appendChild(hiddenField)}}document.body.appendChild(form);form.submit()}Eggshell.define("C.common.viewlimitmodal",{inputs:[],outputs:[]},C.View.extend({initialize:function(){this.model=new C.viewlimitmodal.model;this.model.on("couponDataRetrieved",this.createPopup,this)},viewLimitContent:{dialogId:"view-limit-dialog",primaryBtnText:"Create new account",headline:"UH-OH! WE'VE DETECTED MULTIPLE USERS."},limitMessageTemplate:_.template('<div class="limit-msg-wrapper">'+'<div class="limit-msg">'+"Our system detects multiple users on this account. You can continue to access your existing Textbook Solution books, "+"but access to new books will be blocked for up to 30 days. If you are not the primary account holder, "+"create a new account to immediately regain access. "+'<a href="http://www.chegg.com/contactus/Returns/50994120">Contact us</a> '+"if you have questions or think this is a mistake."+"</div>"+"</div>"+'<img class="avatar" src="<%= avatarPath %>">'),couponTemplate:_.template('<div class="coupon-wrapper">'+'<div class="header">Get <%= couponSavings %> off your first month</div>'+'<input type="text" class="coupon-code" value="<%= couponCode %>" autofocus readonly />'+'<div class="fineprint">Coupon valid for 7 days. Paste code at checkout.</div>'+"</div>"),createPopup:function(){this.popup=Eggshell.create("C.common.dialog");var dialogMarkup=this.limitMessageTemplate({avatarPath:C.global.assetUrl+"site/avatars/img-avatar-gry-60x60.png"})+this.couponTemplate({couponSavings:this.model.get("couponSavings"),couponCode:this.model.get("couponCode")});this.popup.trigger("hide sub headline").trigger("hide icon").trigger("enable default control").trigger("set primary button",this.viewLimitContent.primaryBtnText).trigger("set id",this.viewLimitContent.dialogId).trigger("set headline",this.viewLimitContent.headline).trigger("set content",dialogMarkup).trigger("hide close button").trigger("disable screen blocker click").trigger("show");$("#"+this.viewLimitContent.dialogId).find(".coupon-code").select();C.logger.doSessionLog({viewlimitmodal_seen:1});this.listenToPrimaryBtnClick()},listenToPrimaryBtnClick:function(){$("#"+this.viewLimitContent.dialogId).find(".main-button").on("click",$.proxy(function(e){e.preventDefault();C.logger.doSessionLog({viewlimitmodal_cta_click:1});$.ajax({url:C.global.cheggSiteUrl+"signout",data:{token:C.global.csrfToken},context:this}).done(function(){window.location.href=this.model.get("addToCartUrl")})},this))}}));C("viewlimitmodal");C.viewlimitmodal.model=C.Model.extend({objName:"C.viewlimitmodal.model",initialize:function(){this.getSubsData();this.getCouponCode()},getSubsData:function(){$.ajax({url:"/_ajax/hwh/subscription/",data:{token:C.global.csrfToken},context:this,success:function(response){if(response){var response=response.subsPriceData;var catalogId=typeof response.monthly!=="undefined"?response.monthly.catalogId:null;var priceId=typeof response.monthly!=="undefined"?response.monthly.priceId:null;var addToCartUrl=catalogId&&priceId?this.buildAddToCartUrl(catalogId,priceId):"";this.set("addToCartUrl",addToCartUrl)}}})},getCouponCode:function(){$.ajax({url:"/_ajax/hwh/coupon/",data:{token:C.global.csrfToken},context:this,success:function(res){if(res){this.set("couponSavings",typeof res.couponSavings!=="undefined"?res.couponSavings:"");this.set("couponCode",typeof res.couponCode!=="undefined"?res.couponCode:"")}},error:function(){C.utility.refresh()}}).done(function(response){this.trigger("couponDataRetrieved")})},buildAddToCartUrl:function(catalogId,priceId){return"/shoppingcart/add/?redirect=hwh&command="+catalogId+","+priceId+",1"}});Eggshell.define("C.common.cspricemodal",{inputs:["show cs price modal","set type","update price","set headline","set list content"],outputs:[]},C.View.extend({initialize:function(opts){this.data=$.extend({type:"",alcItemId:""},opts);this.model=new C.cspricemodal.model(this.data);this.model.on("subsDataCaptured",this.createComponent,this);this.fireAdobePaywallEvent()},fireAdobePaywallEvent:function(){C.adobeAnalytics.setData("page",{pageInfo:{pageType:"promotion",pageName:"CS Paywall"},category:{primaryCategory:"Chegg",subCategory1:"Web",subCategory2:"cs"}});C.adobeAnalytics.track("pageView")},createComponent:function(){this.setUpListeners();this.Eggshell.trigger("loaded")},priceTemplate:_.template('<div class="radio-input">'+'<input type="radio" name="cs-radio" <%= checked %> id="<%= option %>" data-priceid="<%= priceId %>" data-catalogid="<%= catalogId %>" data-catalogsource="<%= catalogItemSource %>"/>'+'<label class="form-radio <%= hide %>" for="<%= option %>">&nbsp;</label>'+'<label for="<%= option %>"><span class="radio-label">$<%= label %></span>'+' <div class="radio-term"><%= term %></div></label>'+"</div>"),createPopup:function(){if(typeof this.popup=="undefined"){this.popup=Eggshell.create("C.Eggshell.dialog");var primaryButton=this.data.page==="chkout"?"Update":"Continue";this.popup.trigger("hide sub headline").trigger("hide icon").trigger("enable default control").trigger("set primary button",primaryButton).trigger("set id","cspricemodal");this.displayPopupContent()}this.popup.trigger("show");if(this.data.page!=="chkout"){this.setInitialState()}var userSignedIn=C.global.userUuid||this.data.userSignedIn;if(!userSignedIn){this.popup.trigger("set secondary button","Sign In")}this.setDialogListeners()},displayPopupContent:function(){var payload={el:"#"+this.popup.getId(),priceTemplate:this.priceTemplate,trialPeriod:this.model.getTrialPeriod(),page:this.data.page,type:this.data.type};if(this.model.get("alcOptionExists")){Eggshell.create("C.common.cspricemodal.alacarte",{subsPriceData:this.model.get("subsPriceData")}).trigger("render",payload)}Eggshell.create("C.common.cspricemodal.subscription",{subsPriceData:this.model.get("subsPriceData"),alcOptionExists:this.model.get("alcOptionExists")}).trigger("render",payload)},setDialogListeners:function(){this.listenToPrimaryBtnClick();this.listenToSecondaryBtnClick();this.listenToRadioBtnChange()},listenToPrimaryBtnClick:function(){this.popup.listen("primary button clicked",$.proxy(function(){if(this.data.page!=="chkout"){window.location.href=this.model.getAddToCartUrl(this.catalogId,this.priceId,this.catalogItemSource)}else{this.popup.trigger("hide");this.Eggshell.trigger("update price")}},this));C.adobeAnalytics.track("cs_paywall")},listenToSecondaryBtnClick:function(){var that=this;this.popup.listen("secondary button clicked",function(){C.logger.doSessionLog({signup_flow:"hwhv1"},function(){C.utility.navigate("/auth?redirect="+window.location.pathname)})})},listenToRadioBtnChange:function(){$("input[type=radio]").on("change",$.proxy(function(e){this.Eggshell.trigger("option selected",{priceId:$(e.target).data("priceid"),catalogId:$(e.target).data("catalogid"),catalogItemSource:$(e.target).data("catalogsource")})},this))},setUpListeners:function(){this.Eggshell.on("show cs price modal",this.createPopup).on("set type",this.setType).on("option selected",this.updateSelection).on("set headline",this.setHeadline).on("set list content",this.setListContent)},setHeadline:function(e,payload){this.headline=payload},setListContent:function(e,payload){this.listContent=payload},setInitialState:function(){var priceId=$(".cs-wrapper").find("input[name=cs-radio]").data("priceid"),catalogId=$(".cs-wrapper").find("input[name=cs-radio]").data("catalogid"),catalogItemSource=$(".cs-wrapper").find("input[name=cs-radio]").data("catalogsource");this.updateSelection(this,{priceId:priceId,catalogId:catalogId,catalogItemSource:catalogItemSource});if(!this.model.get("alcOptionExists")){C.utility.setCookie("alcItemId",null,0)}C.utility.setCookie("csPriceModalType",this.data.type)},updateSelection:function(e,payload){this.catalogId=payload.catalogId;this.priceId=payload.priceId;this.catalogItemSource=payload.catalogItemSource;var data={priceId:payload.priceId,catalogId:payload.catalogId,catalogItemSource:payload.catalogItemSource,price:this.model.getPriceGivenPriceId(payload.priceId),desc:this.model.getDesc(payload.priceId,payload.catalogId),term:this.model.getTermGivenPriceId(payload.priceId),trialPeriod:this.model.getTrialPeriod()};C.utility.setLocal("priceSelectedData",data)},setType:function(e,payload){this.data.type=payload}}));C("cspricemodal");C.cspricemodal.model=C.Model.extend({objName:"C.cspricemodal.model",initialize:function(data){this.data=data;this.getSubsData()},getSubsData:function(){$.ajax({url:"/_ajax/hwh/subscription/",type:"GET",data:{token:C.global.csrfToken,alcItemId:this.data.alcItemId,page:this.data.page,csPriceModal:true},context:this,success:function(response){this.set("subsPriceData",response.subsPriceData)},error:function(){C.utility.refresh()}}).done(function(data){this.set("annualOptionExists",this.annualOptionExists());this.set("alcOptionExists",this.alcItemExists());this.set("offerType",this.getOfferType());this.trigger("subsDataCaptured")})},annualOptionExists:function(){return typeof this.get("subsPriceData").yearly!=="undefined"},alcItemExists:function(){return typeof this.get("subsPriceData").alacarte!=="undefined"&&(typeof this.get("subsPriceData").alacarte.prices!=="undefined"&&typeof this.get("subsPriceData").alacarte.prices.price!=="undefined")},getOfferType:function(){if(this.hasFreeTrial()){return"free-trial"}else if(!this.get("annualOptionExists")){return"monthly-only"}else if(this.get("annualOptionExists")&&!this.get("alcOptionExists")){return"monthly-and-annual"}else if(this.get("alcOptionExists")){return"alacarte"}else return"monthly-only"},getAddToCartUrl:function(catalogId,priceId,catalogItemSource){return"/shoppingcart/add/?redirect=hwh&command="+catalogId+","+priceId+",1,"+catalogItemSource},getPriceGivenPriceId:function(priceId){if(this.get("subsPriceData").monthly.priceId===priceId){return this.get("subsPriceData").monthly.price}else if(this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===priceId){return this.get("subsPriceData").yearly.price;

}return this.get("subsPriceData").alacarte.prices.price},getDesc:function(priceId,catalogId){if(this.get("subsPriceData").monthly.priceId===priceId){return this.get("subsPriceData").monthly.desc}else if(this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===priceId){return this.get("subsPriceData").yearly.desc}else if(this.get("alcOptionExists")&&this.get("subsPriceData").alacarte.catalogItemId==catalogId){return this.get("subsPriceData").alacarte.desc}else return""},getTermGivenPriceId:function(priceId){if(this.get("subsPriceData").monthly.priceId===priceId){return"month"}else if(this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===priceId){return"year"}else return""},hasFreeTrial:function(){return parseInt(this.get("subsPriceData").monthly.trialPeriod)<parseInt(this.get("subsPriceData").monthly.renewalPeriod)},getTrialPeriod:function(){if(this.hasFreeTrial()){return this.get("subsPriceData").monthly.trialPeriod}return""}});Eggshell.define("C.common.cspricemodal.alacarte",{inputs:["render"],outputs:[]},C.View.extend({initialize:function(opts){this.data=$.extend({type:"",alcItemId:""},opts);this.model=new C.cspricemodal.alacarte.model({subsPriceData:this.data.subsPriceData});this.setUpListeners()},alcContent:{alcFineprint:"Access limited to the chegg.com website. Excludes mobile app access.",alcSubheaderTBS:"This Textbook Solution",alcSubheaderQNA:"This answer"},setUpListeners:function(){this.Eggshell.on("render",this.render)},render:function(e,payload){this.el=payload.el.split(".").join("-");var html=this.getALaCarteMarkup(payload);$(this.el).find(".content").append(html)},getALaCarteMarkup:function(payload){var subHeader=payload.type==="tbs"?this.alcContent.alcSubheaderTBS:this.alcContent.alcSubheaderQNA,alcContent=this.model.getAlcContent(),markup=payload.type==="tbs"?'<div class="tbs-chapter">Chapter '+alcContent.chapter+", Problem "+alcContent.problem+'</div><div class="tbs-title">'+alcContent.bookTitle+"</div>":'<div class="qna-body">'+alcContent.qnaBody+"</div>";var radioOption='<div class="alc-radio">'+payload.priceTemplate({checked:"checked",option:"alcarte",label:this.model.getALaCartePrice(),term:this.model.getAlcBillingText(),priceId:this.model.getAlcPriceId(),catalogId:this.model.getAlcCatalogId(),hide:""})+"</div>";return'<div class="cs-wrapper"><div class="cs-subheadline">'+subHeader+'</div><div class="alc-content">'+markup+"</div>"+'<div class="cs-fineprint">'+this.alcContent.alcFineprint+"</div>"+radioOption+"</div>"}}));C("cspricemodal.alacarte");C.cspricemodal.alacarte.model=C.Model.extend({objName:"C.cspricemodal.alacarte.model ",initialize:function(data){this.subsPriceData=data.subsPriceData},getALaCartePrice:function(){return this.subsPriceData.alacarte.prices.price},isTBSAlcItem:function(){return this.subsPriceData.alacarte.type.indexOf("TBS")!==-1?true:false},getAlcContent:function(){var alcData={};if(this.isTBSAlcItem()){alcData["bookTitle"]=this.subsPriceData.alacarte.bookTitle;alcData["chapter"]=this.subsPriceData.alacarte.chapterName;alcData["problem"]=this.subsPriceData.alacarte.problemName}else{alcData["qnaBody"]=this.subsPriceData.alacarte.body;if(this.subsPriceData.alacarte.transcribedData){alcData["qnaBody"]=JSON.parse(this.subsPriceData.alacarte.transcribedData).text}}return alcData},getAlcPriceId:function(){return this.subsPriceData.alacarte.prices.logId},getAlcCatalogId:function(){return this.subsPriceData.alacarte.catalogItemId},getAlcBillingText:function(){return this.isTBSAlcItem()?"1 solution":"1 answer"}});Eggshell.define("C.common.cspricemodal.subscription",{inputs:["render"],outputs:[]},C.View.extend({initialize:function(opts){this.data=$.extend({type:""},opts);this.model=new C.cspricemodal.subscription.model({subsPriceData:this.data.subsPriceData});this.setUpListeners()},subsContent:{tbsLi:"<li>Step-by-step Textbook Solutions for over 22,000 ISBNs</li>",answerLi:"<li>Get this answer and millions more</li>",qnaLi:"<li>Ask questions of experts and enthusiasts 24/7</li>",hwhLi:"<li>Search millions of homework answers</li>",tutorsMsg:'<span class="includes">INCLUDES FREE:</span> 30 minutes live, online tutoring (up to $20 value)',headlineAlc:"Select option",headlineNoTrial:"Choose monthly or annual",headlineNoAnnual:"Ace your course",csSubheader:"Chegg Study",tbsSubheader:"All Textbook Solutions and more",qnaSubheader:"All answers, Textbook Solutions and more"},setUpListeners:function(){this.Eggshell.on("render",this.render)},render:function(e,payload){this.el=payload.el.split(".").join("-");$(this.el).find(".content").append(this.getCSMarkup(payload));$(this.el).find(".headline").append(this.getHeadline(payload))},getHeadline:function(payload){if(this.data.alcOptionExists){return this.subsContent.headlineAlc}else if(this.model.hasFreeTrial()){return"Start "+payload.trialPeriod+"-day free trial"}else if(!this.model.get("annualOptionExists")){return this.subsContent.headlineNoAnnual}return this.subsContent.headlineNoTrial},getCSMarkup:function(payload){var hide=this.model.get("annualOptionExists")||this.data.alcOptionExists?"":"hide";this.checkMonthly=this.data.alcOptionExists?"":"checked";this.checkYearly="";if(payload.page==="chkout"){this.getCSDefaultRadio()}var radioOptions='<div class="cs-radio">'+payload.priceTemplate({checked:this.checkMonthly,option:"monthly",label:this.model.getMonthlyPrice(),term:this.model.getBillingText("monthly"),priceId:this.model.getMonthlyPriceId(),catalogId:this.model.getMonthlyCatalogId(),catalogItemSource:this.model.getCatalogItemSource(),hide:hide});if(this.model.get("annualOptionExists")){radioOptions+=payload.priceTemplate({checked:this.checkYearly,option:"yearly",label:this.model.getAnnualPrice(),term:this.model.getBillingText("annually"),priceId:this.model.getAnnualPriceId(),catalogId:this.model.getAnnualCatalogId(),catalogItemSource:this.model.getCatalogItemSource(),hide:hide})}radioOptions+="</div>";var subHeader=this.subsContent.csSubheader;if(this.data.alcOptionExists){subHeader=this.model.isTBSAlcItem()?this.subsContent.tbsSubheader:this.subsContent.qnaSubheader}var csMarkup='<div class="cs-wrapper"><div class="cs-subheadline">'+subHeader+"</div>"+this.getCSListContent()+radioOptions+"</div>";csMarkup+='<div class="tutor-messaging">'+this.subsContent.tutorsMsg+"</div>";return csMarkup},getCSDefaultRadio:function(){if(C.utility.getLocal("priceSelectedData")){var desc=C.utility.getLocal("priceSelectedData").desc;this.checkMonthly="";this.checkYearly="";if(desc.indexOf("annual")!==-1){this.checkYearly="checked"}else if(desc.indexOf("monthly")!==-1){this.checkMonthly="checked"}}},getCSListContent:function(){var list="";if(this.data.type==="qna"){list+=this.subsContent.answerLi+this.subsContent.tbsLi+this.subsContent.qnaLi}else{list+=this.subsContent.tbsLi+this.subsContent.qnaLi+this.subsContent.hwhLi}return'<ul class="cs-list">'+list+"</ul>"}}));C("cspricemodal.subscription");C.cspricemodal.subscription.model=C.Model.extend({objName:"C.cspricemodal.subscription.model",initialize:function(data){this.data=data;this.subsPriceData=data.subsPriceData;this.set("annualOptionExists",this.annualOptionExists())},annualOptionExists:function(){return typeof this.subsPriceData.yearly!=="undefined"},isTBSAlcItem:function(){if(this.data.alcOptionExists){return this.subsPriceData.alacarte.type.indexOf("TBS")!==-1?true:false}return false},getMonthlyPrice:function(){return this.subsPriceData.monthly.price},getAnnualPrice:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.price:""},getMonthlyPriceId:function(){return this.subsPriceData.monthly.priceId},getAnnualPriceId:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.priceId:""},getMonthlyCatalogId:function(){return this.subsPriceData.monthly.catalogId},getAnnualCatalogId:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.catalogId:""},hasFreeTrial:function(){return parseInt(this.subsPriceData.monthly.trialPeriod)<parseInt(this.subsPriceData.monthly.renewalPeriod)},getBillingText:function(term){if(this.hasFreeTrial()){return term+" after trial"}return term},getCatalogItemSource:function(){return this.subsPriceData.monthly.catalogItemSource}});Eggshell.define("C.common.onboardingoverlay",{inputs:{render:{payload:null},set_instruction_points:{payload:"object"},render_header_overlay:{payload:null},show_close_control:{payload:null},dismiss_on_click:{payload:null},set_on_click_callback:{payload:null},hide_overlay:{payload:null}},outputs:[]},function(){var View=Backbone.View.extend({initialize:function(){this.instructionPoints=[];this.showCloseControl=false;this.dismissOnClick=false;this.onClickCallback=null;this.$headerHandle=C.dom&&C.dom.$header?$(C.dom.$header):$(".chgg-hdr");this.origHeaderBorder=this.$headerHandle?this.$headerHandle.css("border-bottom"):"";Eggshell.find(this).on("render",this.render,this).on("show_overlay_close",this.setShowCloseControl,this).on("hide_overlay",this.hideOverlay,this).on("dismiss_on_click",this.setDismissOnClick,this).on("set_on_click_callback",this.setOnClickCallback,this).on("render_header_overlay",this.setRenderHeaderOverlay,this).on("set_instruction_points",this.setInstructionPoints,this)},render:function(){this.$el.prepend(this.overlayTemplate({showCloseControl:this.showCloseControl}));if(this.renderHeaderOverlay){this.$headerHandle.prepend(this.headerOverlayTemplate({}));this.$headerHandle.css({"border-bottom":"none"})}if(this.showCloseControl){this.$el.find(".onboardingoverlay-close").css({top:this.$el.parent().position().top+50})}for(var i=0;i<this.instructionPoints.length;i++){this.instructionPoints[i].id=i;var instructionPoint=this.instructionPoints[i];$(instructionPoint.handle).append(this.instructionPointTemplate({id:instructionPoint.id,top:instructionPoint.top_padding,left:instructionPoint.left_padding,img:instructionPoint.img}))}C.logger.doSessionLog({onboarding_overlay_opened:1});this.setActionListeners()},setInstructionPoints:function(e,payload){if(!payload||typeof payload!=="object"){throw"Invalid instruction point. Type needs to be an object value."}$.extend(this.instructionPoints,payload)},setShowCloseControl:function(e,payload){this.showCloseControl=true},setDismissOnClick:function(e,payload){this.dismissOnClick=true},setRenderHeaderOverlay:function(e,payload){this.renderHeaderOverlay=true},setOnClickCallback:function(e,payload){this.onClickCallback=payload},setActionListeners:function(){if(this.showCloseControl){$(".onboardingoverlay-close").on("click",$.proxy(function(e){Eggshell.find(this).trigger("hide_overlay")},this))}if(this.dismissOnClick){$(".onboardingoverlay-screenblocker, .onboardingoverlay-header-screenblocker").on("click",$.proxy(function(e){Eggshell.find(this).trigger("hide_overlay");if(this.onClickCallback){this.onClickCallback()}},this))}},hideOverlay:function(){C.logger.doSessionLog({onboarding_overlay_closed:1});$(".onboardingoverlay-header-screenblocker, .onboardingoverlay-screenblocker").remove();$(".onboardingoverlay-instruction-point").remove();this.$headerHandle.css({"border-bottom":this.origHeaderBorder});Eggshell.find(this).trigger("destroy")},headerOverlayTemplate:_.template('<div class="onboardingoverlay-header-screenblocker"></div>'),overlayTemplate:_.template('<% if(showCloseControl){ %><div class="onboardingoverlay-close"></div><% } %>'+'<div class="onboardingoverlay-screenblocker"></div>'),instructionPointTemplate:_.template('<div class="onboardingoverlay-instruction-point point-<%- id %>" style="top:<%- top %>px; left:<%- left %>px;"><img src="http://c.cheggcdn.com/_public-assets/<%- img %>"/></div>')});return View}());Eggshell.define("C.common.onboardingsequence",{inputs:{render:{payload:null},set_banner_handle:{payload:"selector"},set_obfuscation_handle:{payload:"selector"},set_instruction_points:{payload:"object"},begin_sequence:{payload:null}},outputs:["sequence_completed","sequence_done"]},function(){var View=Backbone.View.extend({initialize:function(){this.$obfuscationHandle=null;this.$bannerHandle=null;this.$headerHandle=C.dom&&C.dom.$header?$(C.dom.$header):$(".chgg-hdr");this.origHeaderBorder=this.$headerHandle?this.$headerHandle.css("border-bottom"):"";this.instructionPoints=[];this.tooltipSequence=[];this.currentTooltipIndex=null;this.sequenceStarted=false;Eggshell.find(this).on("render",this.render,this).on("set_instruction_points",this.setInstructionPoints,this).on("set_banner_handle",this.setBannerHandle,this).on("set_obfuscation_handle",this.setObfuscationHandle,this).on("begin_sequence",this.beginSequence,this)},render:function(){this.getCleanTooltips();this.renderObfuscation();this.renderTooltips();this.renderBanner()},renderObfuscation:function(){if(this.$obfuscationHandle){this.$obfuscationHandle.prepend(this.obfuscationTemplate({}));this.$headerHandle.append(this.headerObfuscation({}));this.$headerHandle.css({"border-bottom":"none"})}},renderBanner:function(){if(this.$bannerHandle){$(this.bannerTemplate({})).insertAfter(this.$bannerHandle)}this.addBodyClickListener()},renderTooltips:function(){for(var i=0;i<this.instructionPoints.length;i++){var instructionPoint=this.instructionPoints[i];var tooltip=Eggshell.create("C.common.overlay.tooltip");var stepNumber=i+1;tooltip.on("return tooltip content node",$.proxy(function(event,payload){var $el=payload;$el.html(this.instructionPointContentTemplate({stepNumber:stepNumber,content:instructionPoint.content,buttonText:stepNumber==this.instructionPoints.length?"GOT IT":"NEXT",total:this.instructionPoints.length}));this.attachButtonListener(tooltip)},this)).trigger("set target",$(instructionPoint.handle.selector)).trigger("disable tooltip on hover").trigger("disable_max_z_index").trigger("enable close button").trigger("get tooltip content node");switch(instructionPoint.position){case"left":tooltip.trigger("set tooltip on the left of target");break;case"right":tooltip.trigger("set tooltip on the right of target");break;case"top":tooltip.trigger("set tooltip above target");tooltip.trigger("position caret center");break;case"bottom":tooltip.trigger("set tooltip below target");tooltip.trigger("position caret center");break}var tooltipId=tooltip.getId().replace(".","-");$("#"+tooltipId).addClass("onboardingsequence-tooltip");var $highlightHandle=instructionPoint.highlightHandle?instructionPoint.highlightHandle:"";this.tooltipSequence.push({tooltip:tooltip,highlight:$highlightHandle})}},getCleanTooltips:function(){for(var i=0;i<this.instructionPoints.length;i++){var handle=$(this.instructionPoints[i].handle.selector);if(!handle.length){this.instructionPoints.splice(i,1)}}},beginSequence:function(){this.sequenceStarted=true;$.each(this.tooltipSequence,function(i,component){component.tooltip.trigger("hide")});if(this.tooltipSequence&&this.tooltipSequence[0]){this.currentTooltipIndex=0;this.showTooltip(this.tooltipSequence[0].tooltip,this.tooltipSequence[0].highlight,this.currentTooltipIndex+1)}},showNextTooltip:function(){this.tooltipSequence[this.currentTooltipIndex].tooltip.trigger("hide");var step=this.currentTooltipIndex+1;var currentHighlightElem=this.tooltipSequence[this.currentTooltipIndex].highlight;if(step<this.tooltipSequence.length){var nextTooltip=this.tooltipSequence[step].tooltip;var nextHighlight=this.tooltipSequence[step].highlight;this.currentTooltipIndex=step;this.removeHighlight(currentHighlightElem);this.showTooltip(nextTooltip,nextHighlight,this.currentTooltipIndex+1)}else{this.removeObfuscation();this.removeHighlight(currentHighlightElem);this.scrollTo(0);this.removeBodyClickListener();Eggshell.find(this).trigger("sequence_completed");Eggshell.find(this).trigger("sequence_done")}},attachButtonListener:function(tooltip){var tooltipId=tooltip.getId().replace(".","-");var tooltipSelector="#"+tooltipId;$(tooltipSelector+" .close-btn").on("click",$.proxy(function(e){e.preventDefault();e.stopPropagation();var step=$(tooltipSelector).find(".onboardingsequence-instruction-point").data("step");var currentHighlightElem=this.tooltipSequence[step-1].highlight;C.logger.doSessionLog({onboarding_sequence_close:step});this.removeObfuscation();this.removeHighlight(currentHighlightElem);tooltip.trigger("hide");this.removeBodyClickListener();Eggshell.find(this).trigger("sequence_done")},this))},showTooltip:function(tooltip,highlightElem,stepNum){C.logger.doSessionLog({onboarding_sequence_viewed:stepNum});var tooltipId=tooltip.getId().replace(".","-");tooltip.trigger("show");this.addHighlight(highlightElem);this.scrollTo($("#"+tooltipId).position().top-200)},addHighlight:function(elem){elem[0].style.pointerEvents="none";$(elem).addClass("onboarding-sequence-highlight")},removeHighlight:function(elem){elem[0].style.pointerEvents="auto";$(elem).removeClass("onboarding-sequence-highlight")},addBodyClickListener:function(){$("body").bind("click",$.proxy(this.onBodyClick,this))},removeBodyClickListener:function(){$("body").unbind("click",$.proxy(this.onBodyClick,this))},onBodyClick:function(){if(this.sequenceStarted){this.showNextTooltip()}else{$(".onboarding-banner").animate({height:0,opacity:0},400,$.proxy(function(){$(".onboarding-banner").remove();this.beginSequence()},this))}},setInstructionPoints:function(e,payload){if(!payload||typeof payload!=="object"){throw"Invalid instruction point. Type needs to be an object value."}$.extend(this.instructionPoints,payload)},setBannerHandle:function(e,payload){this.$bannerHandle=payload},setObfuscationHandle:function(e,payload){this.$obfuscationHandle=payload},removeObfuscation:function(){$(".onboarding-sequence-obfuscation").remove();$(".onboarding-sequence-header-obfus").remove();this.$headerHandle.css({"border-bottom":this.origHeaderBorder})},instructionPointContentTemplate:_.template('<div class="onboardingsequence-instruction-point" data-step="<%= stepNumber %>">'+'<span class="instruction-point-counter"><%= stepNumber %> of <%= total %></span>'+'<span class="instruction-point-content"><%= content %></span>'+'<button class="btn-primary-outline btn-sm"><%= buttonText %></button>'+"</div>"),bannerTemplate:_.template('<div class="onboarding-banner">'+'<span class="message-text">Welcome to Chegg Study, your start to better grades <button class="btn-primary-outline btn-mini">Show me around</button></span>'+"</div>"),obfuscationTemplate:_.template('<div class="onboarding-sequence-obfuscation"></div>'),headerObfuscation:_.template('<div class="onboarding-sequence-header-obfus"></div>'),scrollTo:function(loc){$("body, html").animate({scrollTop:loc})}});return View}());Eggshell.define("C.page.playerpages_sdk",{inputs:{render:{payload:null}},outputs:{},strict:false},function(){var View=Backbone.View.extend({initialize:function(options){this.options=options;this.firstTimeLoading=true;C.utility.loadScript(this.options.tbsSdkCDN+"js/index.js",this.render.bind(this));this.wireTutorComponent();this.doSessionLogging();this.configureHeaderAutosuggest();this.doFreeAccessOffer();this.Eggshell.on("destroy",this.destroy)},doFreeAccessOffer:function(){if(this.options.accessExpireDate){var callback=function(res){var res=res.subsPriceData,offerDesc=typeof res.monthly!=="undefined"?"$"+res.monthly.price+" monthly":"";$(".global-breadcrumb").addClass("adjust-top");$("#free-access-banner .price").html(offerDesc);$("#free-access-banner button").on("click",$.proxy(function(){C.logger.doSessionLog({freemium_banner_click:"1"});this.displayCSPriceModal()},this))}.bind(this);this.getSubsPriceData(callback);if(C.utility.getParams().freeAccessOffered&&!C.utility.getLocal("freeAccessDialogShown")){C.utility.setLocal("freeAccessDialogShown",1);var freeAccessDialog=Eggshell.create("C.common.dialog").trigger("set headline","Welcome to Chegg Study").trigger("set sub headline","( 24-hour free access )").trigger("set id","free-access-dialog").trigger("set content html","You have access to :<ul><li>Millions of homework answers</li><li>Step-by-step solutions for your textbooks</li></ul>").trigger("enable default control").trigger("set primary button","Start studying").trigger("hide icon").trigger("hide close button").trigger("disable screen blocker click").on("primary button clicked",function(e){$("#free-access-dialog").find(".close").trigger("click")},this);C.logger.doSessionLog({freemium_onboarding:1})}}},getSubsPriceData:function(callback){$.ajax({url:"/_ajax/hwh/subscription/",type:"GET",data:{token:C.global.csrfToken},context:this,success:callback,error:function(res){console.log("Error in getting subscription price data: "+JSON.stringify(res))}})},displayCSPriceModal:function(){var modalComponent=this.options.expCSResponsiveCheckout&&this.options.expCSResponsiveCheckout["new_cs_checkout"]?"C.common.cspricemodal.responsive":"C.common.cspricemodal";if(typeof this.popUp==="undefined"){this.popUp=Eggshell.create(modalComponent).on("loaded",$.proxy(function(){this.popUp.trigger("set type","qna").trigger("show cs price modal")},this))}else{this.popUp.trigger("show cs price modal")}C.logger.doSessionLog({CS_pricemodal:"qna"})},configureHeaderAutosuggest:function(){if(!C.global.webConstellation){var target=$(".chg-header .autosuggest-input-field")}else{var target=$(".chgg-hdr .autosuggest-input-field")}if(C.global.headerAutosuggest){Eggshell.find(C.global.headerAutosuggest).trigger("render",{ajaxEndpoint:"/_ajax/search/tbsserp",target:target,filters:{type:"group",count:5,destination:"tbs"}})}},fixHeaderOnScroll:function(){var $root=$("#solution-player-sdk");var $main=$("#solution-player-sdk .main");var $toc=$(".TBS_TOC");var isDedicatedNav=$(".chgg-hdr").hasClass("type-study");$(window).on("scroll",function(e){var scrollTop=$(window).scrollTop();var playerHeight=$main.height();if(scrollTop>137&&scrollTop<playerHeight+137){$root.addClass(isDedicatedNav?"fixed-dedicated-hdr":"fixed-header");$main.addClass(isDedicatedNav?"adjust-dedicated-main":"adjust-main");$toc.css({top:scrollTop-70+"px"})}else{$root.removeClass(isDedicatedNav?"fixed-dedicated-hdr":"fixed-header");$main.removeClass(isDedicatedNav?"adjust-dedicated-main":"adjust-main");$toc.removeAttr("style")}})},doSessionLogging:function(){if(this.options.editionPage){C.logger.doSessionLog({SDK_edition_page:1})}else if(this.options.chapterPage){C.logger.doSessionLog({SDK_chapter_page:1})}else{C.logger.doSessionLog({SDK_problem_page:1})}},wireTutorComponent:function(){var $tbsTutors=$('<div class="tbs-sub-tutors"></div>');$tbsTutors.insertAfter("#solution-player-sdk");if(!this.options.tutorsExperiment&&this.options.startLiveLessonExp){this.renderTutorEggshell($tbsTutors,"tbs-live-lesson",3)}else{this.renderTutorEggshell($tbsTutors,"tbs",5)}},renderTutorEggshell:function($el,type,count,variant){var tutorComponent=Eggshell.create("C.common.tutors",{el:$el});if(this.options.tutorsExperiment){var tbsUrl=window.location.origin+window.location.pathname;tutorComponent.trigger("set opportunity modal data",{modalContext:"TBS_OPP_FLOW",modalBody:"Hi! I'm working on the following textbook problem and would like some help: "+tbsUrl})}tutorComponent.trigger("show tutors",{type:type,variant:variant,product:"TBS",subjectId:this.options.subjectIdForTutors,subjectName:this.options.subjectNameforTutors,userHasCsSubscription:1,count:count,campaign:"Chegg_Study-TBS",tbsProblemId:this.options.problemId,liveLessonText:this.options.liveLessonText,url:window.location.origin+window.location.pathname,tutorSubType:this.options.tutorSubType})},updateBreadcrumb:function(data,item){if(this.options.chapterPage&&item==="chapter"){var $breadcrumb=$(".global-breadcrumb");$breadcrumb.html($breadcrumb.html().replace(/chapter .+/,"chapter "+data));return}if(item==="chapter"){var $chapterLink=$(".global-breadcrumb a").last();$chapterLink.text("chapter "+data);var updateHref=$chapterLink.attr("href").replace(/-chapter-[^-]+-/,"-chapter-"+data+"-");$chapterLink.attr("href",updateHref)}if(item==="problem"){var $breadcrumb=$(".global-breadcrumb");$breadcrumb.html($breadcrumb.html().replace(/problem .+/,"problem "+data))}},getRoutes:function(){var scrubbedBookTitle=this.scrubTitleForRoutes();var routes={problem:this.convertProblemPathToRoute()};if(!this.options.solutionPage){routes={problem:"/homework-help/"+scrubbedBookTitle+"-"+this.options.editionText+"-edition-chapter-:chapter-problem-:problem-solution-:isbn13",chapter:this.convertChapterPathToRoute()}}if(this.options.editionPage){var path=window.location.pathname;var basePath=path.slice(0,path.lastIndexOf("-"));routes=_.extend(routes,{base:basePath+"-:isbn13"})}return routes},convertProblemPathToRoute:function(){var path=window.location.pathname;var regex=/(.*chapter-)[^-]+(-problem-)[^-]+(-solution-)[^-]+/;return path.replace(regex,"$1:chapter$2:problem$3:isbn13")},convertChapterPathToRoute:function(){var path=window.location.pathname;var regex=/(.*chapter-)[^-]+(-solutions-)[^-]+/;return path.replace(regex,"$1:chapter$2:isbn13")},scrubTitleForRoutes:function(){var scrubbedBookTitle=this.options.bookTitleText?this.options.bookTitleText.replace(/[^\w-_.~]/g,"-"):"";scrubbedBookTitle=scrubbedBookTitle.replace(/-+/g,"-");return scrubbedBookTitle},doAdobeLogging:function(){digitalData.page.pageName="TBS Solution Page";_satellite.track("pageView")},storeBookmarkedKvp:function(){$.ajax({url:"/_ajax/common/userkvp/set",type:"GET",data:{token:C.global.csrfToken,key:"bookmarkedTBS",value:1},context:this,success:$.proxy(function(response){this.displayBookmarkOnboarding();this.options.bookmarkedTBS=true},this),error:function(res){console.log("Error storing user kvp value "+JSON.stringify(res))}})},displayBookmarkOnboarding:function(){var $navItems=$(".nav-item");var $studyBox=$(".nav-item.study-item .nav-hover-box");var $content=$(".chg-container.center-content, .chg-content");$studyBox.css("display","block");$navItems.css("pointer-events","none");$content.css("position","relative");$("body").addClass("noscroll");var overlayOnClickCallback=function(){$studyBox.css("display","none");$navItems.css("pointer-events","auto");$("body").removeClass("noscroll");$content.css("position","static")};var instructionPoints=[{top_padding:15,left_padding:60,handle:$(".nav-item-header.link-textbook-solutions"),img:"site/images/tbs2-overlay-text.png"}];Eggshell.create("C.common.onboardingoverlay",{el:$(".chg-container-content")}).trigger("dismiss_on_click").trigger("set_on_click_callback",overlayOnClickCallback).trigger("set_instruction_points",instructionPoints).trigger("render")},render:function(){var initialLoad=true;var rootUrl=this.options.odinConcatUrl?this.options.odinConcatUrl:window.location.origin;TBSPlayer.setRootURL(rootUrl);var player=TBSPlayer.getPlayer({target:document.querySelector("#solution-player-sdk"),isbn13:this.options.isbn13,user:this.options.userData,routes:this.getRoutes(),show_comments:this.options.accessExpireDate?false:true,show_bookmark:this.options.showBookmark,onProblemOpened:$.proxy(function(res){if(this.options.solutionPage||this.options.chapterPage){this.updateBreadcrumb(res.chapter,"chapter");this.updateBreadcrumb(res.problem,"problem")}C.logger.doSessionLog({isbn_viewed:this.options.isbn13,problem_viewed:res.problem,chapter_viewed:res.chapter});if(!this.firstTimeLoading){this.doAdobeLogging()}this.firstTimeLoading=false},this),onProblemLoaded:$.proxy(function(){if(!initialLoad){var topOfContent=$(".TBS_ROOT .main").offset().top;window.scrollTo(0,topOfContent-50)}else{if(this.options.doOnboardingSequence){setTimeout($.proxy(function(){this.doOnboardingSequence()},this),1e3)}}initialLoad=false},this),onLimitExceeded:function(id){$(".fullscreen.contract").trigger("click");Eggshell.create("C.common.viewlimitmodal")},onNoSolutionCTA:$.proxy(function(){C.utility.navigate(window.location.origin+"/"+this.options.qaPostPage)},this),onNetworkErrorCTA:function(){C.utility.refresh()},onBookmarkClicked:$.proxy(function(res){if(res.bookmarked){C.logger.doSessionLog({bookmark_tbs_save:res.id})}else{C.logger.doSessionLog({bookmark_tbs_unsave:res.id})}if(!this.options.bookmarkedTBS){C.logger.doSessionLog({bookmark_tbs_overlay:1});this.storeBookmarkedKvp()}},this),onReviewClicked:function(res){C.logger.doSessionLog({feedback_click:res.reviewValue==0?"thumbs_up":"thumbs_down"})}});this.fixHeaderOnScroll();this.listenToFullScreenChange()},listenToFullScreenChange:function(){document.addEventListener("mozfullscreenchange",function(){if(!window.fullScreen)$(".fullscreen.contract").trigger("click")},false)},doOnboardingSequence:function(){C.logger.doSessionLog({onboarding_sequence_started:"TBS"});var instructionPoints=[{handle:$(".TBS_TOOLBAR .bookmark-tab"),highlightHandle:$(".TBS_TOOLBAR .bookmark-tab"),content:"Save solution for quick access later on",position:"bottom"},{handle:$(".review-box .thumb-up"),highlightHandle:$(".review-box"),content:"Give us feedback on the solution provided",position:"bottom"},{handle:$(".chgg-hdr-search-container .chgg-hdr-search-box"),highlightHandle:$(".chgg-hdr-search-container .chgg-hdr-search-box"),content:"Search archive of millions of homework answers",position:"bottom"}];var $obfuscationHandle=$(".chg-content");var $bannerHandle=$(".chg-content .global-breadcrumb");$(".chg-container.center-content").css({position:"relative"});Eggshell.create("C.common.onboardingsequence",{el:$(".chg-container-content")}).trigger("set_banner_handle",$bannerHandle).trigger("set_obfuscation_handle",$obfuscationHandle).trigger("set_instruction_points",instructionPoints).on("sequence_completed",function(){C.logger.doSessionLog({onboarding_sequence_completed:"TBS"})}).on("sequence_done",function(){$(".chg-container.center-content").css({position:"static"})}).trigger("render")},destroy:function(){var sdkJSPath=this.options.tbsSdkCDN+"js/index.js";$('script[type="text/javascript"][src~="'+sdkJSPath+'"]').remove()}});return View}());